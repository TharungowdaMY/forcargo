{% extends "base.html" %}
{% block content %}

<h2 style="margin-bottom: 10px;">3D Cargo Network Visualization</h2>

<div id="globeContainer" style="width:100%; height:600px;"></div>

<!-- THREE.js + Globe.gl -->
<script src="https://unpkg.com/three"></script>
<script src="https://unpkg.com/globe.gl"></script>

<script>
const globe = Globe()
(document.getElementById('globeContainer'))
  .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
  .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
  .backgroundColor('rgba(0,0,0,0)')
  .pointOfView({ lat: 20, lng: 78, altitude: 2 }, 3000) // India View
  .arcColor(() => ["#00eaff", "#ff9d00"])
  .arcAltitude(0.2)
  .arcStroke(3)
  .showAtmosphere(true)
  .atmosphereColor('#00eaff')
  .atmosphereAltitude(0.25);

// GET FLIGHTS FROM FLASK
fetch("/api/all_routes")
  .then(res => res.json())
  .then(data => {
    globe
      .arcsData(data)
      .arcDashLength(0.8)
      .arcDashGap(0.2)
      .arcDashAnimateTime(2000)
      .arcsTransitionDuration(1000);

    // Add moving airplane sprite
    globe
      .arcDashInitialGap(() => Math.random());
  });

</script>

{% endblock %}
